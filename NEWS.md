3.99.1
======

## Highlights

<Fill this block manually from the blocks below>

## Features

 * `syslog-format`: accepting longer sdata keys
   
   Triggered by https://github.com/syslog-ng/syslog-ng/issues/3197
   At the end of the discussion in the mentioned issue, we decided
   to change the parser and accept longer than 32 character ID's.
   ([#3244](https://github.com/syslog-ng/syslog-ng/pull/3244))
 * network: add FreeBSD support for the `so_reuseport(yes)` the same as in linux `SO_REUSEPORT` (FreeBSD uses `SO_REUSEPORT_LB` flag).
   ([#3438](https://github.com/syslog-ng/syslog-ng/pull/3438))
 * `filter`: new template function
   
   The new introduced `filter` template function will allow filtering lists based on a filter expression.
   
   For example this snippet removes odd numbers
   ```
   log {
     source { example-msg-generator(num(1) values(INPUT => "0,1,2,3")); };
     destination {
        file("/dev/stdout"
              template("$(filter ('$(% $_ 2)' eq '0') $INPUT)\n)")
        );
     };
   };
   ```
   ([#3426](https://github.com/syslog-ng/syslog-ng/pull/3426))
 * `kafka` (C implementation):
    * Added template support to `topic()`.
    * Added `fallback-topic()` option, which will be used, if the templated `topic()` yields an invalid topic name.
   ([#3372](https://github.com/syslog-ng/syslog-ng/pull/3372))
 * systemd-journal: add namespace() option
   This option accepts a string which is identical to the `--namespace` option of journalctl.
   For systems defining this option with a `systemd` version older than `v245` a warning is issued.
   ([#3358](https://github.com/syslog-ng/syslog-ng/pull/3358))

## Bugfixes

 * json-parser: fix parsing 64 bit numbers (currently 32 bit was a limit)
   ([#3403](https://github.com/syslog-ng/syslog-ng/pull/3403))
 * systemd-journal: add namespace to the persist name
   ([#3407](https://github.com/syslog-ng/syslog-ng/pull/3407))
 * python: printing the exception instead of None (if compiled with clang)
   ([#3405](https://github.com/syslog-ng/syslog-ng/pull/3405))
 * `syslog-ng`: fixed numerous spelling mistakes in messages generated by syslog-ng
   ([#3398](https://github.com/syslog-ng/syslog-ng/pull/3398))
 * afsocket: syslog-ng fails to bind() after config revert
   
   When having a program source or destination and a network destination in the
   config, if we reload with an invalid config, syslog-ng crashes, as it cannot init
   the old network source, because its address is in use.
   ([#3416](https://github.com/syslog-ng/syslog-ng/pull/3416))
 * syslog-ng-ctl: when syslog-ng gets stuck on executing a heavy stats-ctl command, should be
   able to do a graceful shutdown when it is requested.
   ([#3349](https://github.com/syslog-ng/syslog-ng/pull/3349))
 * `map`: pass `$_` to `if` correctly.
   
   Prior this patchset, `if` did not receive `$_` correctly.
   
   After this change, these configurations will work:
   
   ```
   log {
     source { example-msg-generator(num(1) values(INPUT => "0,1,2,3")); };
     destination {
        file("/dev/stdout"
              template("$(map $(if ('$(% $_ 2)' eq '0') 'even' 'odd') $INPUT)'\n)")
        );
     };
   };
   ```
   ([#3426](https://github.com/syslog-ng/syslog-ng/pull/3426))

## Notes to developers

 * Template evaluation related function signatures changed.
   
   A new structure `LogTemplateEvalOptions` is introduced to group parameters together.
   ([#3426](https://github.com/syslog-ng/syslog-ng/pull/3426))

## Other changes

 * json-parser: change every per message logs that was higher than debug to debug
   ([#3401](https://github.com/syslog-ng/syslog-ng/pull/3401))

## Credits

syslog-ng is developed as a community project, and as such it relies
on volunteers, to do the work necessarily to produce syslog-ng.

Reporting bugs, testing changes, writing code or simply providing
feedback are all important contributions, so please if you are a user
of syslog-ng, contribute.

We would like to thank the following people for their contribution:

, Andras Mitzki, Antal Nemes, Attila Szakacs, Balazs Scheidler,
Gabor Nagy, Laszlo Budai, Laszlo Szemere, László Várady,
Norbert Takacs, Zoltan Pallagi
